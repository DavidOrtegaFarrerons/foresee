{{define "title"}}{{.Market.Title}}{{end}}

{{define "main"}}
<div class="w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="flex flex-col lg:flex-row lg:items-start gap-10">

        <div class="flex-1 space-y-8">

            <div class="space-y-2">
                <p class="text-sm text-text-muted">
                    Volume: $10,000,000 â€¢ Expires {{.Market.ExpiresAt}}
                </p>
                <h1 class="text-2xl sm:text-3xl font-bold text-text-primary leading-tight">
                    {{.Market.Title}}
                </h1>
                <div class="flex flex-wrap gap-2 text-sm text-text-muted">
                    <span class="bg-border-subtle px-2 py-1 rounded-md">{{.Market.Category}}</span>
                    <span class="bg-border-subtle px-2 py-1 rounded-md">Resolver: {{.Market.Resolver}}</span>
                    <span class="bg-border-subtle px-2 py-1 rounded-md capitalize">{{.Market.Status}}</span>
                </div>
            </div>

            <div class="space-y-4">
                <div class="flex items-center gap-4">
                    <p class="text-accent text-xl font-semibold">22% chance</p>
                    <span class="text-success text-sm font-medium">â–² 13%</span>
                </div>
                <div class="bg-border-subtle/20 h-48 rounded-lg flex items-center justify-center text-text-muted text-sm border border-border-subtle">
                    ðŸ“ˆ Chart Coming Soon
                </div>
            </div>

            <div class="space-y-4">
                <h2 class="text-lg font-semibold text-text-primary">Market Context</h2>
                <p class="text-text-muted">{{.Market.Description}}</p>
            </div>

        </div>

        <div class="w-full lg:max-w-sm lg:sticky lg:top-10 space-y-4">

            <div class="rounded-xl border border-border-subtle bg-bg-elevated p-6 space-y-6">
                <h3 class="text-lg font-semibold text-text-primary mb-2">Bet</h3>

                <div class="flex gap-2">
                    {{range .Market.Outcomes}}
                    {{if eq $.Market.Status "open"}}
                    <button
                            type="button"
                            onclick="openBetModal('{{.ID}}')"
                            class='flex-1 py-3 text-base font-medium text-white rounded-md transition
                                {{if eq .Label "yes"}}bg-success hover:bg-success/80{{else}}bg-danger hover:bg-danger/80{{end}}'>
                        {{.Label}}
                    </button>

                    {{else if eq $.Market.Status "expired"}}
                    <button
                            type="button"
                            disabled
                            class="flex-1 py-3 text-base font-medium rounded-md bg-gray-400 text-gray-700 cursor-not-allowed">
                        {{.Label}}
                    </button>

                    {{else if eq $.Market.Status "resolved"}}
                    {{if .IsWinner}}
                    <button
                            type="button"
                            disabled
                            class='flex-1 py-3 text-base font-medium text-white rounded-md
                                    {{if eq .Label "yes"}}bg-success{{else}}bg-danger{{end}}'>
                        {{.Label}}
                    </button>
                    {{else}}
                    <button
                            type="button"
                            disabled
                            class="flex-1 py-3 text-base font-medium rounded-md bg-gray-400 text-gray-700 cursor-not-allowed">
                        {{.Label}}
                    </button>
                    {{end}}
                    {{end}}
                    {{end}}
                </div>

                {{if eq .Market.Status "open"}}
                <div id="bet-modal" class="fixed inset-0 hidden items-center justify-center bg-black/60 z-50">
                    <div class="w-full max-w-sm bg-bg-elevated rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-text-primary mb-4">
                            Place bet
                        </h3>

                        <form method="POST" action="/markets/{{.Market.ID}}/bets" class="space-y-4">
                            <input type='hidden' name='csrf_token' value='{{.CSRFToken}}'>
                            <input type="hidden" name="outcome_id" id="bet-outcome-id">

                            <div>
                                <label class="block text-sm text-text-secondary mb-1">
                                    Amount
                                </label>
                                <input
                                        type="number"
                                        name="amount"
                                        min="100"
                                        step="100"
                                        required
                                        class="w-full rounded-md bg-bg-main border border-border-subtle px-3 py-2 text-text-primary focus:outline-none focus:ring-2 focus:ring-accent"
                                >
                                <p class="text-xs text-text-muted mt-1">
                                    Minimum bet: 100 coins
                                </p>

                                {{with .Form.FieldErrors.amount}}
                                <p class="text-sm text-danger mt-1">{{.}}</p>
                                {{end}}
                            </div>

                            <div class="flex gap-2">
                                <button type="submit" class="flex-1 py-2 rounded-md bg-accent text-black font-medium">
                                    Confirm
                                </button>
                                <button type="button" onclick="closeBetModal()" class="flex-1 py-2 rounded-md border border-border-subtle text-text-secondary">
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                {{end}}

            </div>

        </div>
    </div>
</div>

<script>
    function openBetModal(outcomeId) {
        document.getElementById("bet-outcome-id").value = outcomeId
        const modal = document.getElementById("bet-modal")
        modal.classList.remove("hidden")
        modal.classList.add("flex")
    }

    function closeBetModal() {
        const modal = document.getElementById("bet-modal")
        modal.classList.add("hidden")
        modal.classList.remove("flex")
    }
</script>
{{end}}
